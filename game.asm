INCLUDE Irvine32.inc
includelib winmm.lib

.data
    
    CreateFile PROTO,          ; create new file
    pFilename:PTR BYTE,     ; ptr to filename
    accessMode:DWORD,       ; access mode
    shareMode:DWORD,        ; share mode
    lpSecurity:DWORD,       ; can be NULL
    howToCreate:DWORD,      ; how to create the file
    attributes:DWORD,       ; file attributes
    htemplate:DWORD         ; handle to template file 

    ReadFile PROTO,       ; read buffer from input file
    fileHandle:DWORD,     ; handle to file
    pBuffer:PTR BYTE,     ; ptr to buffer
    nBufsize:DWORD,       ; number bytes to read
    pBytesRead:PTR DWORD, ; bytes actually read
    pOverlapped:PTR DWORD ; ptr to asynchronous info

    PlaySound PROTO,
    pszSound:PTR BYTE, 
    hmod:DWORD, 
    fdwSound:DWORD
        
    SND_FILENAME DWORD 00020000h
    SND_LOOP DWORD  00000008h
    SND_ASYNC DWORD 00000001h
    file BYTE "D:\Assignments\SEMESTER#04\COAL Lab\L3\gamemusic.wav" , 0

    filehandling_array byte 10 dup(15 dup('-'))
    highscores_file_handle dword ?
    highscores_file_name byte "C:\Users\dell\Desktop\coal_project\coal_project\highscores.txt",0
    temp_filehandling_score dd 0
    temp_filehandling_array byte 15 dup('-')
    temp_filehandling_array2 byte 15 dup('-')
    temp_index dd 0

    menu_text0 byte " _____       ______      _____                    ______      __  __     ",0Ah,0
    menu_text1 byte "/\  _` \    /\  _  \    /\  _ `\      /'\_/`\    /\  _  \    /\ \/\ \    ",0Ah,0
    menu_text2 byte "\ \ \L\ \   \ \ \L\ \   \ \ \/\_\    /\      \   \ \ \L\ \   \ \ `\\ \   ",0Ah,0
    menu_text3 byte " \ \ ,__/    \ \  __ \   \ \ \/_/_   \ \ \__\ \   \ \  __ \   \ \ , ` \  ",0Ah,0
    menu_text4 byte "  \ \ \/      \ \ \/\ \   \ \ \L\ \   \ \ \_/\ \   \ \ \/\ \   \ \ \`\ \ ",0Ah,0
    menu_text5 byte "   \ \_\       \ \_\ \_\   \ \____/    \ \_\\ \_\   \ \_\ \_\   \ \_\ \_\ ",0Ah,0
    menu_text6 byte "    \/_/        \/_/\/_/    \/___/      \/_/ \/_/    \/_/\/_/    \/_/\/_/",0
                                                                         
    menu_start_text byte "S T A R T",0                            
    menu_options_text byte "S E T T I N G S",0                                 
    menu_quit_text byte "Q U I T",0       

    menu_current_option byte 1
    menu_arrow byte "==>",0
    menu_arrow_empty byte "    ",0

    settings_current_option byte 1
    settings_back_text byte "B A C K  T O  M E N U : ",0
    settings_mute_text byte "M U T E  G A M E : ",0
    settings_color_text byte "C O L O R  O F  P A C M A N === (1) FOR YELLOW // (2) FOR BROWN : ",0
    settings_cheats_text1 byte "C H E A T S === E N T E R  N U M B E R : ",0
    settings_cheats_text2 byte "                (1) A L W A Y S  P O W E R E D  U P ",0
    settings_cheats_text3 byte "                (2) P R E S S  E N T E R  T O  S K I P  L E V E L",0
    settings_cheats_text4 byte "                (3) 5X  S C O R E  M U L T I P L I E R",0

    cheats_enabled_bool byte 0
    cheats_bool_powerup byte 0
    cheats_bool_levelskip byte 0
    cheats_bool_multiplier byte 1

    name_box_text1 byte     "<><><><><><><><><><><><><><><><><><><><><>",0
    name_box_text2 byte     "<>",0
    name_ask_screen_text byte "E N T E R  N A M E : ",0

    sidebar_empty byte "                                     ",0
    hscr_str byte "H I G H S C O R E S",0
    top5_stats_str byte 17 dup('-'),0,0

    ground BYTE "##============================================================================================================================================================##",0
    ground1 BYTE "|",0
    ground2 BYTE "|",0

    loading_level1 db "##============================================================================================================================================================##",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                            _     _____  ___ ______ _____ _   _ _____                                                       ||",0Ah
                   db "||                                                           | |   |  _  |/ _ \|  _  \_   _| \ | |  __ \                                                      ||",0Ah
                   db "||                                                           | |   | | | / /_\ \ | | | | | |  \| | |  \/                                                      ||",0Ah
                   db "||                                                           | |   | | | |  _  | | | | | | | . ` | | __                                                       ||",0Ah
                   db "||                                                           | |___\ \_/ / | | | |/ / _| |_| |\  | |_\ \                                                      ||",0Ah
                   db "||                                                           \_____/\___/\_| |_/___/  \___/\_| \_/\____/                                                      ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                          L E V E L 1                                                                       ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                             <<   T H E   B E G I N N I N G   >>                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                  W                                                                                                                                         ||",0Ah
                   db "||                A S D  ---> To Move Around                                                                                                                  ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                  0    ---> Ghost                                                                                                                           ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "##============================================================================================================================================================##",0

    level1_walls_1 db "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||",0
    level1_walls_2 db "||//////////////////////////////////////////////////////////////////////////////////////////////////////////////////||",0
    level1_walls_3 db "||//..............................................................................................................//||",0
    level1_walls_4 db "||//. ////////////////////////////////////////////////////  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ .//||",0
    level1_walls_5 db "||//. //||||||||||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||||||||||\\ .//||",0
    level1_walls_6 db "||//. //||||||||||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||||||||||\\ .//||",0
    level1_walls_7 db "||//. //||||||||||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||||||||||\\ .//||",0
    level1_walls_8 db "||//.   .//|||||||||||||||||||||||||||||||||||||||||||||//  \\|||||||||||||||||||||||||||||||||||||||||||||\\.   .//||",0
    level1_walls_9 db "||//.      .//||||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||||\\.      .//||",0
   level1_walls_10 db "||//.        .//||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||\\.        .//||",0
   level1_walls_11 db "||//.          .//||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||\\.          .//||",0
   level1_walls_12 db "||//.           .//|||||||||||||||||||||||||||||||||||||//  \\|||||||||||||||||||||||||||||||||||||\\.           .//||",0
   level1_walls_13 db "||//.            .////////////////////////////////////////  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\.            .//||",0
   level1_walls_14 db "||//.            ....................................................................................            .//||",0
   level1_walls_15 db "||//.            .////////////////////////////////////////  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\.            .//||",0
   level1_walls_16 db "||//.           .//|||||||||||||||||||||||||||||||||||||//  \\|||||||||||||||||||||||||||||||||||||\\.           .//||",0
   level1_walls_17 db "||//.          .//||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||\\.          .//||",0
   level1_walls_18 db "||//.        .//||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||\\.        .//||",0
   level1_walls_19 db "||//.      .//||||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||||\\.      .//||",0
   level1_walls_20 db "||//.   .//|||||||||||||||||||||||||||||||||||||||||||||//  \\|||||||||||||||||||||||||||||||||||||||||||||\\.   .//||",0
   level1_walls_21 db "||//. //||||||||||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||||||||||\\ .//||",0
   level1_walls_22 db "||//. //||||||||||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||||||||||\\ .//||",0
   level1_walls_23 db "||//. //||||||||||||||||||||||||||||||||||||||||||||||||//  \\||||||||||||||||||||||||||||||||||||||||||||||||\\ .//||",0
   level1_walls_24 db "||//. ////////////////////////////////////////////////////  \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ .//||",0
   level1_walls_25 db "||//..............................................................................................................//||",0
   level1_walls_26 db "||//////////////////////////////////////////////////////////////////////////////////////////////////////////////////||",0
   level1_walls_27 db "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||",0

   
    loading_level2 db "##============================================================================================================================================================##",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                            _     _____  ___ ______ _____ _   _ _____                                                       ||",0Ah
                   db "||                                                           | |   |  _  |/ _ \|  _  \_   _| \ | |  __ \                                                      ||",0Ah
                   db "||                                                           | |   | | | / /_\ \ | | | | | |  \| | |  \/                                                      ||",0Ah
                   db "||                                                           | |   | | | |  _  | | | | | | | . ` | | __                                                       ||",0Ah
                   db "||                                                           | |___\ \_/ / | | | |/ / _| |_| |\  | |_\ \                                                      ||",0Ah
                   db "||                                                           \_____/\___/\_| |_/___/  \___/\_| \_/\____/                                                      ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                          L E V E L 2                                                                       ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                             <<   T H E   C H A L L E N G E   >>                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                  W                                                                                                                                         ||",0Ah
                   db "||                A S D  ---> To Move Around                                                                                                                  ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                  0    ---> Ghost                                                                                                                           ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                  &    ---> Fruit                                                                                                                           ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "##============================================================================================================================================================##",0

    level2_walls_1 db "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||",0
    level2_walls_2 db "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||",0
    level2_walls_3 db "||||. . . . . . . . . . . . . . . . . . . . . . . . . . .  . . . . . . . . . . . . . . . . . . . . . . . . . . . .||||",0
    level2_walls_4 db "||||. //////  //////  //        //////  //////   ////// //  |||||||||||||||||||||||||||||||||||||||||||||||||||| .||||",0
    level2_walls_5 db "||||.     //      //  //           //  //       //     //   |||||||||||||||||||||||||||||||||||||||||||||||||||| .||||",0
    level2_walls_6 db "||||. //////  //////  //  //  //////  ///////  ////// //    |||||||||||||||||||||||||||||||||||||||||||||||||||| .||||",0
    level2_walls_7 db "||||. //          //  //     //      //   //      // //     |||||||||||||||||||||||||||||||||||||||||||||||||||| .||||",0
    level2_walls_8 db "||||  //////  //////  //    //////  /////// /////// //      |||||||||||||||||||||||||||||||||||||||||||||||||||| .||||",0
    level2_walls_9 db "||||.                                           . . . . .  . . . . . . ||||||||||||||||||||||||||||||||||||||||| .||||",0
   level2_walls_10 db "||||. ||||||||||||||||||||||||||||||||||||||||| .|||||||||  |||||||||. ||||||||||||||||||||||||||||||||||||||||| .||||",0
   level2_walls_11 db "||||.                                           .|||              |||.                                           .||||",0
   level2_walls_12 db "||||.  \\\\\\\\\\\   \\\\\\\\\\\   \\\\\\\\\\\  .|||              |||.  ///////////   ///////////   //////////   .||||",0
   level2_walls_13 db "||||.   \\\\\\\\\\\   \\\\\\\\\\\   \\\\\\\\\\\ .|||              |||. ///////////   ///////////   //////////    .||||",0
   level2_walls_14 db "    . . . . . . . . . . . . . . . . . . . . . . .                    . . . . . . . . . . . . . . . . . . . . . . .    ",0
   level2_walls_15 db "||||.   ///////////   ///////////   /////////// .|||              |||. \\\\\\\\\\\   \\\\\\\\\\\\   \\\\\\\\\\   .||||",0
   level2_walls_16 db "||||.  ///////////   ///////////   ///////////  .|||              |||.  \\\\\\\\\\\   \\\\\\\\\\\\   \\\\\\\\\\  .||||",0
   level2_walls_17 db "||||.                                           .|||              |||.                                           .||||",0
   level2_walls_18 db "||||. ||||||||||||||||||||||||||||||||||||||||| .|||||||||  |||||||||. ||||||||||||||||||||||||||||||||||||||||| .||||",0
   level2_walls_19 db "||||. ||||||||||||||||||||||||||||||||||||||||| . . . . .  . . . . . . ||||||||||||||||||||||||||||||||||||||||| .||||",0
   level2_walls_20 db "||||. ||||||||||||||||||||||||||||||||||||||||||||||||||||  |||||||||||||||||||||||||||||||||||||||||||||||||||| .||||",0
   level2_walls_21 db "||||. ||||||||||||||||||||||||||||||||||||||||||||||||||||  |||||||||||||||||||||||||||||||||||||||||||||||||||| .||||",0
   level2_walls_22 db "||||.                                                                                                            .||||",0
   level2_walls_23 db "||||. ||||||||||||||||||||||||||||||||||||||||||||||||||||  |||||||||||||||||||||||||||||||||||||||||||||||||||| .||||",0
   level2_walls_24 db "||||. ||||||||||||||||||||||||||||||||||||||||||||||||||||  |||||||||||||||||||||||||||||||||||||||||||||||||||| .||||",0
   level2_walls_25 db "||||. . . . . . . . . . . . . . . . . . . . . . . . . . .  . . . . . . . . . . . . . . . . . . . . . . . . . . . .||||",0
   level2_walls_26 db "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||",0
   level2_walls_27 db "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||",0

   
    loading_level3 db "##============================================================================================================================================================##",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                            _     _____  ___ ______ _____ _   _ _____                                                       ||",0Ah
                   db "||                                                           | |   |  _  |/ _ \|  _  \_   _| \ | |  __ \                                                      ||",0Ah
                   db "||                                                           | |   | | | / /_\ \ | | | | | |  \| | |  \/                                                      ||",0Ah
                   db "||                                                           | |   | | | |  _  | | | | | | | . ` | | __                                                       ||",0Ah
                   db "||                                                           | |___\ \_/ / | | | |/ / _| |_| |\  | |_\ \                                                      ||",0Ah
                   db "||                                                           \_____/\___/\_| |_/___/  \___/\_| \_/\____/                                                      ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                           L E V E L   3                                                                    ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                <<   T H E   S H O W D O W N   >>                                                           ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                  W                                                                                                                                         ||",0Ah
                   db "||                A S D  ---> To Move Around                                                                                                                  ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                  0    ---> Ghost                                                                                                                           ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                  &    ---> Fruit                                                                                                                           ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "##============================================================================================================================================================##",0

    level3_walls_1 db "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||",0
    level3_walls_2 db "||||..............................................................................................................||||",0
    level3_walls_3 db "|||||||||||||||||||||||||||||||..|||||||||||||||                      |||||||||||||||..|||||||||||||||||||||||||||||||",0
    level3_walls_4 db "|||||||||||||||||||||||||||||||..|||||||||||||||  ||||||||||||||||||  |||||||||||||||..|||||||||||||||||||||||||||||||",0
    level3_walls_5 db "||||.............................        .............    ||    .............        .............................||||",0
    level3_walls_6 db "||||.             ||||||||||||| .||||||| .||||||||   .    ||    .   ||||||||. |||||||. |||||||||||||             .||||",0
    level3_walls_7 db "||||.   ||||||||||||||||||||||| .||||||| .||||||||   .    ||    .   ||||||||. |||||||. |||||||||||||||||||||||   .||||",0
    level3_walls_8 db "||||.   ||||||||||||||||||||||| .||||||| .||||||||   ............   ||||||||. |||||||. |||||||||||||||||||||||   .||||",0
    level3_walls_9 db "||||.   ||||||||||||||||||||||| .||||||| .||||||||||||||||..||||||||||||||||. |||||||. |||||||||||||||||||||||   .||||",0
   level3_walls_10 db "||||.   ||||||||||||||||||||||| ..........||||||||||||||||..||||||||||||||||.......... |||||||||||||||||||||||   .||||",0
   level3_walls_11 db "||||..............||||||||||||||||||||||  |||||||| ................ ||||||||  ||||||||||||||||||||||..............||||",0
   level3_walls_12 db "||||             .||||||||||||||||||||||  |||||||| . |||||  ||||| . ||||||||  ||||||||||||||||||||||.             ||||",0
   level3_walls_13 db "||||             .||||||||||||||||||||||  |||||||| .||||      ||||. ||||||||  ||||||||||||||||||||||.             ||||",0
   level3_walls_14 db "                 ...................................              ...................................                 ",0
   level3_walls_15 db "||||             .||||||||  |||||||||||||||||||||| .||||      ||||. ||||||||||||||||||||||  ||||||||.             ||||",0
   level3_walls_16 db "||||             .||||||||  ||||              |||| . |||||  ||||| . ||||              ||||  ||||||||.             ||||",0
   level3_walls_17 db "||||..............||||||||  ||||  ||||||||||  |||| ................ ||||  ||||||||||  ||||  ||||||||..............||||",0
   level3_walls_18 db "||||. ||||||||||||||||||||  ||||  ||||||||||  ||||||||||||..||||||||||||  ||||||||||  ||||  |||||||||||||||||||| .||||",0
   level3_walls_19 db "||||. ||||||||||||||||||||  ||||  ||||||||||  ||||||||||||..||||||||||||  ||||||||||  ||||  |||||||||||||||||||| .||||",0
   level3_walls_20 db "||||. ||||||||||||||||||||  ||||  ||||||||||  ||||        ..        ||||  ||||||||||  ||||  |||||||||||||||||||| .||||",0
   level3_walls_21 db "||||. ||||||||||||||||||||  ||||                          ||                          ||||  |||||||||||||||||||| .||||",0
   level3_walls_22 db "||||. ||||||||||||||||||||  ||||||||||||||||||||||        ||        ||||||||||||||||||||||  |||||||||||||||||||| .||||",0
   level3_walls_23 db "||||...........                                           ||                                           ...........||||",0
   level3_walls_24 db "||||||||||||||. ||||||||||||||||||||||||||||||||  ||||||||||||||||||  |||||||||||||||||||||||||||||||| .||||||||||||||",0
   level3_walls_25 db "||||||||||||||............. ||||||||||||||||||||                      |||||||||||||||||||| .............||||||||||||||",0
   level3_walls_26 db "||||||||||||||||||||||||||..................................................................||||||||||||||||||||||||||",0
   level3_walls_27 db "||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||",0

    ending_screen  db "##============================================================================================================================================================##",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                             _____ _   _  _____   _____ _   _______                                                         ||",0Ah
                   db "||                                                            |_   _| | | ||  ___| |  ___| \ | |  _  \                                                        ||",0Ah
                   db "||                                                              | | | |_| || |__   | |__ |  \| | | | |                                                        ||",0Ah
                   db "||                                                              | | |  _  ||  __|  |  __|| . ` | | | |                                                        ||",0Ah
                   db "||                                                              | | | | | || |___  | |___| |\  | |/ /                                                         ||",0Ah
                   db "||                                                              \_/ \_| |_/\____/  \____/\_| \_/___/                                                          ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "||                                                                                                                                                            ||",0Ah
                   db "##============================================================================================================================================================##",0                           
                                        

    current_level db 1
    current_level_walls dd ?

    temp byte ?

    strScore1 BYTE " CURRENT SCORE : ",0
    strLives BYTE " CURRENT LIVES : ",0
    strName BYTE " CURRENT PLAYER : ",0
    score dd 0  
    current_lives dd 3
    player_name byte 11 dup(?),0
    pacmancolor dd yellow
    fruitEaten db 0
    fruit_steps db 0

    xPos BYTE 11
    yPos BYTE 15
    
    direction_ghost_1 byte 3
    direction_ghost_2 byte 2
    direction_ghost_3 byte 4
    current_ghost byte 1
    has_ghost1_changed_direction byte 1
    has_ghost2_changed_direction byte 1
    has_ghost3_changed_direction byte 1
    random90degreechange byte 0


    ; setting ghost coordinates
    xPosGhost1 BYTE 109
    yPosGhost1 BYTE 15
    xPosGhost2 BYTE 200
    yPosGhost2 BYTE 200
    xPosGhost3 BYTE 200
    yPosGhost3 BYTE 200

    total_coin_count dd 0

    inputChar BYTE 0
    menuPassed BYTE 0

.code
main PROC


    call MakeHighScoreFile
    call ReadHighScoreFile
    mov current_level_walls,offset level1_walls_1

    mov eax, SND_FILENAME  
    or eax, SND_LOOP       
    or eax, SND_ASYNC 
    invoke PlaySound, addr file,0,eax

    cmp menuPassed,1
    je pass_menu_label

    call DrawMenu
    call MenuFunctionality
    
    call clrscr
    mov eax,green
    call settextcolor
    mov edx,offset loading_level1
    call writestring

    mov eax,3000
    call delay
    jmp pass_menu_label


    go_to_next_level:

        call ResetVariables

        cmp current_level,1
        je go_to_level_2
        cmp current_level,2
        je go_to_level_3
        cmp current_level,3
        je exitGame

        jmp exitGame

        go_to_level_2:
            call clrscr
            mov eax,lightred
            call settextcolor
            mov edx,offset loading_level2
            call writestring

            mov eax,3000
            call delay
            mov current_level_walls,offset level2_walls_1
            mov current_level,2
            mov xPos,5
            mov yPos,4
            mov xPosGhost1,59
            mov yPosGhost1,15
            mov xPosGhost2,200
            mov yPosGhost2,200
            mov xPosGhost3,200
            mov yPosGhost3,200
            jmp pass_menu_label
        go_to_level_3:
            call clrscr
            mov eax,cyan
            call settextcolor
            mov edx,offset loading_level3
            call writestring

            mov eax,3000
            call delay
            mov current_level_walls,offset level3_walls_1
            mov current_level,3
            mov xPos,5
            mov yPos,3
            mov xPosGhost1,59
            mov yPosGhost1,15
            mov xPosGhost2,57
            mov yPosGhost2,15
            mov xPosGhost3,61
            mov yPosGhost3,15
            jmp pass_menu_label

    pass_menu_label:
    call DrawGameScreen
    call Randomize

    gameLoop:
        mov eax,white (black * 16)
        call SetTextColor

        ; draw score:
        call PrintScore
        call PrintLives
        call PrintName

        mov current_ghost,1
        call MoveGhosts
        cmp current_level,3
        jne moved_ghosts_levelwise
        mov current_ghost,2
        call MoveGhosts
        mov current_ghost,3
        call MoveGhosts

        moved_ghosts_levelwise:
        mov eax,75
        call Delay
        call ReadKey
        jz gameLoop 
        mov inputChar,al

        ; exit game if user types 'x':
        cmp inputChar,"x"
        je exitGame

        cmp inputChar,"w"
        je moveUp

        cmp inputChar,"s"
        je moveDown

        cmp inputChar,"a"
        je moveLeft

        cmp inputChar,"d"
        je moveRight

        cmp inputChar,"="
        je complete_level_cheat

        jmp keep_looping_gameloop

        complete_level_cheat:
            cmp cheats_bool_levelskip,0
            je keep_looping_gameloop

            mov eax,total_coin_count
            add score,eax
            mov total_coin_count,0
            jmp keep_looping_gameloop

        moveUp:
            cmp yPos,2
            jne check_further_for_up

            call UpdatePlayer
            mov yPos,28
            call DrawPlayer
            jmp keep_looping_gameloop

            check_further_for_up:
                mov esi,current_level_walls
                movzx edx,yPos
                dec edx
                dec edx
                dec edx
                imul edx,119
                add esi,edx
                movzx edx,xPos
                dec edx
                add esi,edx
                mov dl,byte ptr [esi]
                cmp dl,124
                je keep_looping_gameloop
                cmp dl,47
                je keep_looping_gameloop
                cmp dl,92
                je keep_looping_gameloop

                call UpdatePlayer
                dec yPos
                call DrawPlayer
                jmp keep_looping_gameloop

        moveDown:
            cmp yPos,28
            jne check_further_for_down

            call UpdatePlayer
            mov yPos,2
            call DrawPlayer
            jmp keep_looping_gameloop


            check_further_for_down:
                mov esi,current_level_walls
                movzx edx,yPos
                dec edx
                imul edx,119
                add esi,edx
                movzx edx,xPos
                dec edx
                add esi,edx
                mov dl,byte ptr [esi]
                cmp dl,124
                je keep_looping_gameloop
                cmp dl,47
                je keep_looping_gameloop
                cmp dl,92
                je keep_looping_gameloop

                call UpdatePlayer
                inc yPos
                call DrawPlayer
                jmp keep_looping_gameloop

        moveLeft:
            cmp xPos,1
            jne check_further_for_left

            call UpdatePlayer
            mov xPos,118
            call DrawPlayer
            jmp keep_looping_gameloop
        
            check_further_for_left:
                mov esi,current_level_walls
                movzx edx,yPos
                dec edx
                dec edx
                imul edx,119
                add esi,edx
                movzx edx,xPos
                dec edx
                dec edx
                add esi,edx
                mov dl,byte ptr [esi]
                cmp dl,124
                je keep_looping_gameloop
                cmp dl,47
                je keep_looping_gameloop
                cmp dl,92
                je keep_looping_gameloop

                call UpdatePlayer
                dec xPos
                call DrawPlayer
                jmp keep_looping_gameloop

        moveRight:
            cmp xPos,118    
            jne check_further_for_right

            call UpdatePlayer
            mov xPos,1
            call DrawPlayer
            jmp keep_looping_gameloop
        
            check_further_for_right:
        
                mov esi,current_level_walls
                movzx edx,yPos
                dec edx
                dec edx
                imul edx,119
                add esi,edx
                movzx edx,xPos
                add esi,edx
                mov dl,byte ptr [esi]
                cmp dl,124
                je keep_looping_gameloop
                cmp dl,47
                je keep_looping_gameloop
                cmp dl,92
                je keep_looping_gameloop

                call UpdatePlayer
                inc xPos
                call DrawPlayer
                jmp keep_looping_gameloop

    keep_looping_gameloop:
        
        cmp total_coin_count,0
        jne loop_gameloop_ahead

        jmp go_to_next_level

        loop_gameloop_ahead:

            mov al,fruitEaten
            or al,cheats_bool_powerup

            cmp al,1
            jne gameLoop

            cmp pacmancolor,lightRed
            je change_to_lb

            mov pacmancolor,lightred
            jmp color_fruit_handled

            change_to_lb:
            mov pacmancolor,lightblue

            color_fruit_handled:

            inc fruit_steps

            cmp fruit_steps,100
            jne gameloop

            mov fruit_steps,0
            mov fruitEaten,0
            mov pacmancolor,yellow

            jmp gameLoop

    exitGame:
    call WriteHighScoreFile

    call clrscr
    mov eax,lightred
    call settextcolor
    mov edx,offset ending_screen
    call writestring

    mov dl,60
    mov dh,18
    call gotoxy
    mov edx,offset player_name
    call writestring
    
    mov dl,75
    mov dh,18
    call gotoxy
    mov eax,score
    call writeint

    mov eax,10000
    call delay

    exit
main ENDP

CountCoinsInLevel PROC

    
    mov esi,current_level_walls

    start_counting_coins:

    mov ecx,27
    mov al,0
    mov ah,0
    mov edi,0

    coin_counter_loop_outer:

        mov ebx,ecx
        mov ecx,118

        coin_counter_loop_inner:
            mov dl,'.'
            cmp [esi],dl
            jne coin_counter_loop_inner_cont

            mov dl,al
            add dl,1
            mov dh,ah
            add dh,2

            cmp edi,3
            jae no_fruit_spawn
            mov eax,90
            call randomrange

            cmp al,1
            jne no_fruit_spawn

            call Gotoxy
            mov eax,magenta
            call SetTextColor
            mov al,"&"
            call WriteChar
            mov [esi],al
            inc edi
            jmp spawned_cont

            no_fruit_spawn:

                call Gotoxy
                mov eax,yellow
                call SetTextColor
                mov al,"."
                call WriteChar
                inc total_coin_count

            spawned_cont:  
            
                sub dl,1
                mov al,dl
                sub dh,2
                mov ah,dh

        coin_counter_loop_inner_cont:
        inc esi
        inc al
        LOOP coin_counter_loop_inner

        mov ecx,ebx

        mov al,0
        inc ah
        inc esi

    LOOP coin_counter_loop_outer

ret
CountCoinsInLevel ENDP

ColorSlashes PROC

    
    mov esi,current_level_walls

    start_slashes_loop:

    mov ecx,27
    mov al,0
    mov edi,0

    slash_counter_loop_outer:

        mov ebx,ecx
        mov ecx,118

        slash_counter_loop_inner:
            mov dl,47
            cmp [esi],dl
            je color_slash 
            mov dl,92
            cmp [esi],dl
            je color_slash 
            jne slash_counter_loop_inner_cont


            color_slash:
                mov dl,al
                add dl,1
                mov dh,ah
                add dh,2

                call Gotoxy
                mov eax,white
                call SetTextColor
                mov al,byte ptr [esi]
                call WriteChar

                sub dl,1
                mov al,dl
                sub dh,2
                mov ah,dh

        slash_counter_loop_inner_cont:
        inc esi
        inc al
        LOOP slash_counter_loop_inner

        mov ecx,ebx

        add edi,2
        mov al,0
        inc ah
        inc esi

    LOOP slash_counter_loop_outer

ret
ColorSlashes ENDP

DrawLevelWalls PROC

    mov bl,1
    mov bh,2
    mov ecx,27

    cmp current_level,1
    je drawing_level_1
    cmp current_level,2
    je drawing_level_2
    cmp current_level,3
    je drawing_level_3

    drawing_level_1:
        mov eax,green
        call settextcolor
        mov esi,offset level1_walls_1
        jmp level_drawing_loop
    drawing_level_2:
        mov eax,lightred
        call settextcolor
        mov esi,offset level2_walls_1
        jmp level_drawing_loop
    drawing_level_3:
        mov eax,cyan
        call settextcolor
        mov esi,offset level3_walls_1
        jmp level_drawing_loop

    level_drawing_loop:
            mov dl,bl
            mov dh,bh
            call Gotoxy
            mov edx,esi
            call WriteString
            add esi,119
            inc bh
        LOOP level_drawing_loop

DrawLevelWalls_exit:
ret
DrawLevelWalls ENDP

DrawSelectionArrow PROC

    mov eax,yellow ;(blue*16)
    call SetTextColor

    mov dl,68

    cmp menu_current_option,1
    je start_selected
    cmp menu_current_option,2
    je options_selected
    cmp menu_current_option,3
    je quit_selected

    start_selected:
        mov dh,18
        jmp DrawSelectionArrow_exit

    options_selected:
        mov dh,20
        jmp DrawSelectionArrow_exit

    quit_selected:
        mov dh,22
        jmp DrawSelectionArrow_exit

    DrawSelectionArrow_exit:
        call Gotoxy
        mov edx,OFFSET menu_arrow
        call WriteString
        ret
DrawSelectionArrow ENDP

UpdateSelectionArrow PROC

    mov eax,yellow ;(blue*16)
    call SetTextColor

    mov dl,68

    cmp menu_current_option,1
    je start_selected_update
    cmp menu_current_option,2
    je options_selected_update
    cmp menu_current_option,3
    je quit_selected_update

    start_selected_update:
        mov dh,18
        jmp UpdateSelectionArrow_exit

    options_selected_update:
        mov dh,20
        jmp UpdateSelectionArrow_exit

    quit_selected_update:
        mov dh,22
        jmp UpdateSelectionArrow_exit

    UpdateSelectionArrow_exit:
        call Gotoxy
        mov edx,offset menu_arrow_empty
        call WriteString
        ret
UpdateSelectionArrow ENDP

DrawSelectionArrow_Settings PROC

    mov eax,yellow ;(blue*16)
    call SetTextColor

    mov dl,5

    cmp settings_current_option,1
    je back_selected_settings
    cmp settings_current_option,2
    je mute_selected_settings
    cmp settings_current_option,3
    je colour_selected_settings
    cmp settings_current_option,4
    je cheat_selected_Settings

    back_selected_settings:
        mov dh,4
        jmp DrawSelectionArrow_Settings_exit

    mute_selected_settings:
        mov dh,6
        jmp DrawSelectionArrow_Settings_exit

    colour_selected_settings:
        mov dh,8
        jmp DrawSelectionArrow_Settings_exit

    cheat_selected_Settings:
        mov dh,10
        jmp DrawSelectionArrow_Settings_exit

    DrawSelectionArrow_Settings_exit:
        call Gotoxy
        mov edx,OFFSET menu_arrow
        call WriteString
        ret
DrawSelectionArrow_Settings ENDP

UpdateSelectionArrow_Settings PROC

    mov eax,yellow ;(blue*16)
    call SetTextColor

    mov dl,5

    cmp settings_current_option,1
    je back_selected_update_Settings
    cmp settings_current_option,2
    je mute_selected_update_Settings
    cmp settings_current_option,3
    je color_selected_update_Settings
    cmp settings_current_option,4
    je cheats_selected_update_Settings
    jmp UpdateSelectionArrow_Settings_exit

    back_selected_update_Settings:
        mov dh,4
        jmp UpdateSelectionArrow_Settings_exit

    mute_selected_update_Settings:
        mov dh,6
        jmp UpdateSelectionArrow_Settings_exit

    color_selected_update_Settings:
        mov dh,8
        jmp UpdateSelectionArrow_Settings_exit

    cheats_selected_update_Settings:
        mov dh,10
        jmp UpdateSelectionArrow_Settings_exit

    UpdateSelectionArrow_Settings_exit:
        call Gotoxy
        mov edx,offset menu_arrow_empty
        call WriteString
        ret
UpdateSelectionArrow_Settings ENDP

DrawPlayer PROC
    ; draw player at (xPos,yPos):
    mov eax,pacmancolor ;(blue*16)
    call SetTextColor

    mov esi,current_level_walls
    movzx edx,yPos
    dec edx
    dec edx
    imul edx,119
    add esi,edx
    movzx edx,xPos
    dec edx
    add esi,edx
    mov dl,byte ptr [esi]
    cmp dl,2eh
    je eating_coin
    cmp dl,'&'
    je eating_fruit
    jmp cont_drawing_player

    eating_coin:
        mov dl,' '
        mov [esi],dl

        dec total_coin_count
        movzx edx,cheats_bool_multiplier
        add score,edx
        jmp cont_drawing_player

    eating_fruit:
        mov dl,' '
        mov [esi],dl
        
        mov fruitEaten,1
        mov fruit_steps,0
        add score,25
        

    cont_drawing_player:
        mov dl,xPos
        mov dh,yPos
        call Gotoxy
        
        cmp dl,xPosGhost1
        jne check_second_ghost
        mov current_ghost,1
        cmp dh,yPosGhost1
        je death_found

        check_second_ghost:
        cmp dl,xPosGhost2
        jne check_third_ghost
        mov current_ghost,2
        cmp dh,yPosGhost2
        je death_found

        check_third_ghost:
        cmp dl,xPosGhost3
        jne no_death_player
        mov current_ghost,3
        cmp dh,yPosGhost3
        je death_found

        jmp no_death_player

        death_found:
            mov al,cheats_bool_powerup
            or al,fruitEaten

            cmp al,1
            jne player_killed

            call Death_Ghost
            jmp no_death_player

            player_killed:
            call Death_Player

        no_death_player:
            mov al,"X"
            call WriteChar
            ret
DrawPlayer ENDP

UpdatePlayer PROC
    mov eax,black
    call settextcolor
    mov dl,xPos
    mov dh,yPos
    call Gotoxy
    mov al," "
    call WriteChar
    ret
UpdatePlayer ENDP

DrawGhost PROC

    mov esi,offset xPosGhost1

    cmp current_ghost,1 
    je choose_ghost_1_for_drawing
    cmp current_ghost,2
    je choose_ghost_2_for_drawing
    cmp current_ghost,3
    je choose_ghost_3_for_drawing

    choose_ghost_1_for_drawing:
        mov eax,green ;(blue*16)
        call SetTextColor
        mov dl,[esi]
        mov dh,[esi+1]
        call Gotoxy
        jmp DrawGhost_exit
    choose_ghost_2_for_drawing:
        add esi,2
        mov eax,magenta ;(blue*16)
        call SetTextColor
        mov dl,[esi]
        mov dh,[esi+1]
        call Gotoxy
        jmp DrawGhost_exit
    choose_ghost_3_for_drawing:
        add esi,4
        mov eax,cyan ;(blue*16)
        call SetTextColor
        mov dl,[esi]
        mov dh,[esi+1]
        call Gotoxy
        jmp DrawGhost_exit

    ; draw ghost at (xPos,yPos):
    
    DrawGhost_exit:
    
    cmp dl,xPos
    jne no_death_ghost
    cmp dh,yPos
    jne no_death_ghost
    
    mov al,cheats_bool_powerup
    or al,fruitEaten

    cmp al,1
    jne ghost_kills_player

    call Death_Ghost
    jmp no_death_ghost

    ghost_kills_player:
    call Death_Player

    no_death_ghost:

        cmp current_ghost,1 
        jne next_ghost2

        mov esi,offset xPosGhost1
        mov eax,green ;(blue*16)
        call SetTextColor
        jmp final_ghost_drawing

        next_ghost2:
        cmp current_ghost,2
        jne next_ghost3

        mov esi,offset xPosGhost2
        mov eax,magenta ;(blue*16)
        call SetTextColor
        jmp final_ghost_drawing

        next_ghost3:
        cmp current_ghost,3
        mov esi,offset xPosGhost3
        mov eax,cyan ;(blue*16)
        call SetTextColor
        jmp final_ghost_drawing

    final_ghost_drawing:
    mov dl,[esi]
    mov dh,[esi+1]
    call gotoxy
    mov al,"O"
    call WriteChar
    ret
DrawGhost ENDP

Death_Player PROC

    dec current_lives

    cmp current_level,1
    je player_died_in_level_1
    cmp current_level,2
    je player_died_in_level_2
    cmp current_level,3
    je player_died_in_level_3
    
    jmp Death_Player_exit

    player_died_in_level_1:
        call UpdatePlayer
        mov dl,11
        mov xPos,dl
        mov dh,15
        mov yPos,dh
        call DrawPlayer
        jmp Death_Player_exit
    player_died_in_level_2:
        call UpdatePlayer
        mov dl,5
        mov xPos,dl
        mov dh,4
        mov yPos,dh
        jmp Death_Player_exit
    player_died_in_level_3:
        call UpdatePlayer
        mov dl,5
        mov xPos,dl
        mov dh,3
        mov yPos,dh
        jmp Death_Player_exit

Death_Player_exit:
ret
Death_Player ENDP

Death_Ghost PROC

    add score,100
    
    cmp current_level,1
    jne next_level_check_ghostdeath1

    mov bl,59
    mov bh,15
    jmp check_which_ghost_died

    next_level_check_ghostdeath1:
    cmp current_level,2
    jne next_level_check_ghostdeath2
    
    mov bl,109
    mov bh,15
    jmp check_which_ghost_died

    next_level_check_ghostdeath2:
    mov bl,59
    mov bh,15
    jmp check_which_ghost_died

    check_which_ghost_died:

    cmp current_ghost,1
    je first_ghost_killed
    cmp current_ghost,2
    je second_ghost_killed
    cmp current_ghost,3
    je third_ghost_killed
    
    jmp Death_Ghost_exit

    first_ghost_killed:
        call UpdateGhost
        mov dl,bl
        mov xPosGhost1,dl
        mov dh,bh
        mov yPosGhost1,dh
        call DrawGhost
        jmp Death_Ghost_exit
    second_ghost_killed:
        call UpdateGhost
        mov dl,bl
        mov xPosGhost2,dl
        mov dh,bh
        mov yPosGhost2,dh
        call DrawGhost
        jmp Death_Ghost_exit
    third_ghost_killed:
        call UpdateGhost
        mov dl,bl
        mov xPosGhost3,dl
        mov dh,bh
        mov yPosGhost3,dh
        call DrawGhost
        jmp Death_Ghost_exit

Death_Ghost_exit:
ret
Death_Ghost ENDP



UpdateGhost PROC

    mov esi,offset xPosGhost1

    cmp current_ghost,1 
    je choose_ghost_1_for_drawing
    cmp current_ghost,2
    je choose_ghost_2_for_drawing
    cmp current_ghost,3
    je choose_ghost_3_for_drawing

    choose_ghost_1_for_drawing:
        mov eax,green ;(blue*16)
        call SetTextColor
        mov dl,[esi]
        mov dh,[esi+1]
        call Gotoxy
        jmp UpdateGhost_exit
    choose_ghost_2_for_drawing:
        add esi,2
        mov eax,magenta ;(blue*16)
        call SetTextColor
        mov dl,[esi]
        mov dh,[esi+1]
        call Gotoxy
        jmp UpdateGhost_exit
    choose_ghost_3_for_drawing:
        add esi,4
        mov eax,cyan ;(blue*16)
        call SetTextColor
        mov dl,[esi]
        mov dh,[esi+1]
        call Gotoxy
        jmp UpdateGhost_exit

    ; draw ghost at (xPos,yPos):
    
    UpdateGhost_exit:
    mov ebp,current_level_walls
    movzx edx,byte ptr[esi+1]
    dec edx
    dec edx
    imul edx,119
    add ebp,edx
    movzx edx,byte ptr[esi]
    dec edx
    add ebp,edx
    mov dl,byte ptr [ebp]

    cmp dl,'&'
    jne ghost_over_coin

    mov eax,magenta
    call settextcolor
    jmp ghost_over_colored

    ghost_over_coin:
    mov eax,yellow
    call settextcolor

    ghost_over_colored:
    mov al,dl
    call WriteChar
    ret
ret
UpdateGhost ENDP

MoveGhosts PROC   

    MoveGhosts_start:

    mov esi,offset xPosGhost1

    cmp current_ghost,1 
    je choose_ghost_1
    cmp current_ghost,2
    je choose_ghost_2
    cmp current_ghost,3
    je choose_ghost_3

    choose_ghost_1:
        mov bl,direction_ghost_1
        mov edi,offset direction_ghost_1
        mov ecx,offset has_ghost1_changed_direction
        jmp random_90_chance_check
    choose_ghost_2:
        mov bl,direction_ghost_2
        mov edi,offset direction_ghost_2
        mov ecx,offset has_ghost2_changed_direction
        add esi,2
        jmp random_90_chance_check
    choose_ghost_3:
        mov bl,direction_ghost_3
        mov edi,offset direction_ghost_3
        mov ecx,offset has_ghost3_changed_direction
        add esi,4
        jmp random_90_chance_check

    random_90_chance_check:
    
        mov eax,1000
        call randomrange
        cmp eax,50
        jb change_90_degrees
        jmp compare_directions

        change_90_degrees:
            cmp bl,1
            je change_to_horizontal
            cmp bl,3
            je change_to_horizontal
            cmp bl,2
            je change_to_vertical
            cmp bl,4
            je change_to_vertical

            change_to_horizontal:
                
                mov eax,2
                call randomrange
                cmp eax,1
                je change_to_left
                
                change_to_right:
                    mov bl,2
                    mov [edi],bl
                    jmp compare_directions
                    
                change_to_left:
                    mov bl,4
                    mov [edi],bl
                    jmp compare_directions
                

            change_to_vertical:
            
                mov eax,2
                call randomrange
                cmp eax,1
                je change_to_up
                
                change_to_down:
                    mov bl,3
                    mov [edi],bl
                    jmp compare_directions
                    
                change_to_up:
                    mov bl,1
                    mov [edi],bl
                    jmp compare_directions

    compare_directions:

        cmp bl,1
        je move_ghost_up
        cmp bl,2
        je move_ghost_right
        cmp bl,3
        je move_ghost_down
        cmp bl,4
        je move_ghost_left

        move_ghost_up:
            mov dh,[esi+1]
            cmp dh,2
            je change_direction

            mov ebp,current_level_walls
            movzx edx,byte ptr[esi+1]
            dec edx
            dec edx
            dec edx
            imul edx,119
            add ebp,edx
            movzx edx,byte ptr[esi]
            dec edx
            add ebp,edx
            mov dl,byte ptr [ebp]
            cmp dl,124
            je change_direction
            cmp dl,47
            je change_direction
            cmp dl,92
            je change_direction

            call UpdateGhost
            mov dh,[esi+1]
            dec dh
            mov [esi+1],dh
            call DrawGhost
            mov dl,0
            mov [ecx],dl
            jmp MoveGhosts_exit
        move_ghost_down:
            mov dh,[esi+1]
            cmp dh,28
            je change_direction

            mov ebp,current_level_walls
            movzx edx,byte ptr[esi+1]
            dec edx
            imul edx,119
            add ebp,edx
            movzx edx,byte ptr[esi]
            dec edx
            add ebp,edx
            mov dl,byte ptr [ebp]
            cmp dl,124
            je change_direction
            cmp dl,47
            je change_direction
            cmp dl,92
            je change_direction

            call UpdateGhost
            mov dh,[esi+1]
            inc dh
            mov [esi+1],dh
            call DrawGhost
            mov dl,0
            mov [ecx],dl
            jmp MoveGhosts_exit
        move_ghost_left:
            mov dh,[esi]
            cmp dh,1
            je change_direction

            mov ebp,current_level_walls
            movzx edx,byte ptr[esi+1]
            dec edx
            dec edx
            imul edx,119
            add ebp,edx
            movzx edx,byte ptr[esi]
            dec edx
            dec edx
            add ebp,edx
            mov dl,byte ptr [ebp]
            cmp dl,124
            je change_direction
            cmp dl,47
            je change_direction
            cmp dl,92
            je change_direction

            call UpdateGhost
            mov dh,[esi]
            dec dh
            mov [esi],dh
            call DrawGhost
            mov dl,0
            mov [ecx],dl
            jmp MoveGhosts_exit
        move_ghost_right:
            mov dh,[esi]
            cmp dh,119
            je change_direction

            mov ebp,current_level_walls
            movzx edx,byte ptr[esi+1]
            dec edx
            dec edx
            imul edx,119
            add ebp,edx
            movzx edx,byte ptr[esi]
            add ebp,edx
            mov dl,byte ptr [ebp]
            cmp dl,124
            je change_direction
            cmp dl,47
            je change_direction
            cmp dl,92
            je change_direction

            call UpdateGhost
            mov dh,[esi]
            inc dh
            mov [esi],dh
            call DrawGhost
            mov dl,0
            mov [ecx],dl
            jmp MoveGhosts_exit

    change_direction:
        
        mov dh,[edi]
        mov dl,[ecx]

        cmp dh,1
        je vertically_moving
        cmp dh,3
        je vertically_moving

        cmp dh,2
        je horizontally_moving
        cmp dh,4
        je horizontally_moving

        vertically_moving:
            cmp dl,1
            mov dl,0
            mov [ecx],dl
            je horizontally_moving

            check_right:
                mov ebp,current_level_walls
                movzx edx,byte ptr[esi+1]
                dec edx
                dec edx
                imul edx,119
                add ebp,edx
                movzx edx,byte ptr[esi]
                add ebp,edx
                mov dl,byte ptr [ebp]
                cmp dl,124
                je check_left
                cmp dl,47
                je check_left
                cmp dl,92
                je check_left
                mov dh,2
                mov [edi],dh
                mov dl,1
                mov [ecx],dl
                jmp MoveGhosts_exit

            check_left:
                mov ebp,current_level_walls
                movzx edx,byte ptr[esi+1]
                dec edx
                dec edx
                imul edx,119
                add ebp,edx
                movzx edx,byte ptr[esi]
                dec edx
                dec edx
                add ebp,edx
                mov dl,byte ptr [ebp]
                cmp dl,124
                je MoveGhosts_exit
                cmp dl,47
                je MoveGhosts_exit
                cmp dl,92
                je MoveGhosts_exit
                mov dh,4
                mov [edi],dh
                mov dl,1
                mov [ecx],dl
                jmp MoveGhosts_exit
        horizontally_moving:
            cmp dl,1
            mov dl,0
            mov [ecx],dl
            je vertically_moving

            check_up:
                mov ebp,current_level_walls
                movzx edx,byte ptr[esi+1]
                dec edx
                dec edx
                dec edx
                imul edx,119
                add ebp,edx
                movzx edx,byte ptr[esi]
                dec edx
                add ebp,edx
                mov dl,byte ptr [ebp]
                cmp dl,124
                je check_down
                cmp dl,47
                je check_down
                cmp dl,92
                je check_down
                mov dh,1
                mov [edi],dh
                mov dl,1
                mov [ecx],dl
                jmp MoveGhosts_exit

            check_down:
                mov ebp,current_level_walls
                movzx edx,byte ptr[esi+1]
                dec edx
                imul edx,119
                add ebp,edx
                movzx edx,byte ptr[esi]
                dec edx
                add ebp,edx
                mov dl,byte ptr [ebp]
                cmp dl,124
                je vertically_moving
                cmp dl,47
                je vertically_moving
                cmp dl,92
                je MoveGhosts_exit
                mov dh,3
                mov [edi],dh
                mov dl,1
                mov [ecx],dl
                jmp MoveGhosts_exit

MoveGhosts_exit:
ret
MoveGhosts ENDP

DrawMenu PROC

    call clrscr

    ; draw horizontal menu border
    mov eax,black + (yellow * 16)
    call SetTextColor
    mov dl,0
    mov dh,29
    call Gotoxy
    mov edx,OFFSET ground
    call WriteString
    mov dl,0
    mov dh,1
    call Gotoxy
    mov edx,OFFSET ground
    call WriteString
    
    ; draw vertical left menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop1:
    mov dh,temp
    mov dl,0
    call Gotoxy
    mov edx,OFFSET ground1
    call WriteString
    inc temp
    loop loop1

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop2:
    mov dh,temp
    mov dl,1
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    loop loop2

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop3:
    mov dh,temp
    mov dl,158
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    loop loop3

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop4:
    mov dh,temp
    mov dl,159
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    loop loop4

    
    
    ;menu display

    ; draw menu at (0,29):
    mov eax,magenta ;(black * 16)
    call SetTextColor

    mov dl,43
    mov dh,5
    call Gotoxy
    mov edx,OFFSET menu_text0
    call WriteString

    mov dl,43
    mov dh,6
    call Gotoxy
    mov edx,OFFSET menu_text1
    call WriteString

    mov dl,43
    mov dh,7
    call Gotoxy
    mov edx,OFFSET menu_text2
    call WriteString

    mov dl,43
    mov dh,8
    call Gotoxy
    mov edx,OFFSET menu_text3
    call WriteString

    mov dl,43
    mov dh,9
    call Gotoxy
    mov edx,OFFSET menu_text4
    call WriteString

    mov dl,43
    mov dh,10
    call Gotoxy
    mov edx,OFFSET menu_text5
    call WriteString 

    mov dl,43
    mov dh,11
    call Gotoxy
    mov edx,OFFSET menu_text6
    call WriteString 

    ;draw menu options
    mov eax,cyan 
    call SetTextColor

    mov dl,75
    mov dh,18
    call Gotoxy
    mov edx,OFFSET menu_start_text
    call WriteString

    mov dl,73
    mov dh,20
    call Gotoxy
    mov edx,OFFSET menu_options_text
    call WriteString

    mov dl,76
    mov dh,22
    call Gotoxy
    mov edx,OFFSET menu_quit_text
    call WriteString

ret
DrawMenu ENDP

DrawOptions PROC

    call clrscr

    ; draw horizontal menu border
    mov eax,black + (yellow * 16)
    call SetTextColor
    mov dl,0
    mov dh,29
    call Gotoxy
    mov edx,OFFSET ground
    call WriteString
    mov dl,0
    mov dh,1
    call Gotoxy
    mov edx,OFFSET ground
    call WriteString
    
    ; draw vertical left menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop_options_1:
    mov dh,temp
    mov dl,0
    call Gotoxy
    mov edx,OFFSET ground1
    call WriteString
    inc temp
    LOOP loop_options_1

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop_options_2:
    mov dh,temp
    mov dl,1
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    LOOP loop_options_2

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop_options_3:
    mov dh,temp
    mov dl,158
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    LOOP loop_options_3

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop_options_4:
    mov dh,temp
    mov dl,159
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    LOOP loop_options_4

    mov eax,cyan 
    call SetTextColor

    mov dl,9
    mov dh,4
    call Gotoxy
    mov edx,OFFSET settings_back_text
    call WriteString

    mov dl,9
    mov dh,6
    call Gotoxy
    mov edx,OFFSET settings_mute_text
    call WriteString

    mov dl,9
    mov dh,8
    call Gotoxy
    mov edx,OFFSET settings_color_text
    call WriteString

    cmp cheats_enabled_bool,0
    je DrawOptions_exit
    mov dl,9
    mov dh,10
    call Gotoxy
    mov edx,OFFSET settings_cheats_text1
    call WriteString

    cmp cheats_enabled_bool,0
    je DrawOptions_exit
    mov dl,25
    mov dh,12
    call Gotoxy
    mov edx,OFFSET settings_cheats_text2
    call WriteString
    
    cmp cheats_enabled_bool,0
    je DrawOptions_exit
    mov dl,9
    mov dh,14
    call Gotoxy
    mov edx,OFFSET settings_cheats_text3
    call WriteString
    
    cmp cheats_enabled_bool,0
    je DrawOptions_exit
    mov dl,9
    mov dh,16
    call Gotoxy
    mov edx,OFFSET settings_cheats_text4
    call WriteString

DrawOptions_exit:
ret 
DrawOptions ENDP

DrawNameAskScreen PROC
    call clrscr

    mov eax,black + (yellow * 16)
    call SetTextColor
    mov dl,0
    mov dh,29
    call Gotoxy
    mov edx,OFFSET ground
    call WriteString
    mov dl,0
    mov dh,1
    call Gotoxy
    mov edx,OFFSET ground
    call WriteString
    
    ; draw vertical left menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop_name_1:
    mov dh,temp
    mov dl,0
    call Gotoxy
    mov edx,OFFSET ground1
    call WriteString
    inc temp
    LOOP loop_name_1

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop_name_2:
    mov dh,temp
    mov dl,1
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    LOOP loop_name_2

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop_name_3:
    mov dh,temp
    mov dl,158
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    LOOP loop_name_3

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    loop_name_4:
    mov dh,temp
    mov dl,159
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    LOOP loop_name_4

    
    ; draw menu at (0,29):
    mov eax,magenta ;(black * 16)
    call SetTextColor

    mov dl,43
    mov dh,5
    call Gotoxy
    mov edx,OFFSET menu_text0
    call WriteString

    mov dl,43
    mov dh,6
    call Gotoxy
    mov edx,OFFSET menu_text1
    call WriteString

    mov dl,43
    mov dh,7
    call Gotoxy
    mov edx,OFFSET menu_text2
    call WriteString

    mov dl,43
    mov dh,8
    call Gotoxy
    mov edx,OFFSET menu_text3
    call WriteString

    mov dl,43
    mov dh,9
    call Gotoxy
    mov edx,OFFSET menu_text4
    call WriteString

    mov dl,43
    mov dh,10
    call Gotoxy
    mov edx,OFFSET menu_text5
    call WriteString 

    mov dl,43
    mov dh,11
    call Gotoxy
    mov edx,OFFSET menu_text6
    call WriteString 

    mov dl,60
    mov dh,15
    call GoToXY

    mov eax,white
    call SetTextColor

    mov edx,offset name_ask_screen_text
    call writestring

    
    mov eax,magenta
    call SetTextColor
    
    mov dl,56
    mov dh,13
    call GoToXY

    mov edx,offset name_box_text1
    call writestring
    
    mov dl,56
    mov dh,17
    call GoToXY

    mov edx,offset name_box_text1
    call writestring

    mov dl,56
    mov dh,14
    call GoToXY

    mov edx,offset name_box_text2
    call writestring
    
    mov dl,56
    mov dh,15
    call GoToXY

    mov edx,offset name_box_text2
    call writestring
    
    mov dl,56
    mov dh,16
    call GoToXY

    mov edx,offset name_box_text2
    call writestring
    
    mov dl,96
    mov dh,14
    call GoToXY

    mov edx,offset name_box_text2
    call writestring
    
    mov dl,96
    mov dh,15
    call GoToXY

    mov edx,offset name_box_text2
    call writestring
    
    mov dl,96
    mov dh,16
    call GoToXY

    mov edx,offset name_box_text2
    call writestring
    
    mov dl,81
    mov dh,15
    call GoToXY

    mov eax,white
    call settextcolor

    mov edx,offset player_name
    mov ecx,10
    call readstring

    mov ecx,10
    mov ebp,0
    standardizer_loop:
        cmp player_name[ebp],0Ah
        jne standardizer_loop_cont

        mov player_name[ebp],0

        standardizer_loop_cont:
        inc ebp
        LOOP standardizer_loop

ret
DrawNameAskScreen ENDP

MenuFunctionality PROC

menu_looper:
call DrawSelectionArrow
        cmp menuPassed,1
        je MenuFunctionality_exit

        call ReadChar
        mov inputChar,al

        cmp inputChar,"w"
        je menu_up

        cmp inputChar,"s"
        je menu_down

        cmp inputChar,13
        je menu_enter 

        jmp menu_looper

        menu_up:
            call UpdateSelectionArrow
            dec menu_current_option
            
            cmp menu_current_option,0
            jne continue_drawing_menu_arrow1 

            mov menu_current_option,3

            continue_drawing_menu_arrow1:
            call DrawSelectionArrow
           
            jmp menu_looper

        menu_down:
            call UpdateSelectionArrow
            inc menu_current_option
            cmp menu_current_option,4
            jne continue_drawing_menu_arrow2

            mov menu_current_option,1

            continue_drawing_menu_arrow2:
            call DrawSelectionArrow
           
            jmp menu_looper

        menu_enter:
            cmp menu_current_option,1
            je start_selected_for_enter
            cmp menu_current_option,2
            je options_selected_for_enter
            cmp menu_current_option,3
            je quit_selected_for_enter
            jmp menu_looper

            start_selected_for_enter:
                call DrawNameAskScreen
                mov menuPassed,1
                jmp menu_looper
            options_selected_for_enter:
                call DrawOptions
                cmp cheats_enabled_bool,1
                je chsetting_looper

                jmp settings_looper
            quit_selected_for_enter:
                exit
            jmp menu_looper

        settings_looper:
            call DrawSelectionArrow_Settings
            call ReadChar
            mov inputChar,al

            cmp inputChar,"w"
            je settings_up

            cmp inputChar,"s"
            je settings_down

            cmp inputChar,13
            je settings_enter 

            cmp inputChar,'1'
            je cheat_reader

            jmp settings_looper

            cheat_reader:
                call ReadChar
                mov inputChar,al

                cmp inputChar,'1'
                jne settings_looper

                
                call ReadChar
                mov inputChar,al

                cmp inputChar,'1'
                jne settings_looper
                call ReadChar
                mov inputChar,al

                cmp inputChar,'1'
                jne settings_looper

                mov eax,cyan
                call settextcolor
                
            mov dl,9
            mov dh,10
            call Gotoxy
            mov edx,OFFSET settings_cheats_text1
            call WriteString

            mov dl,9
            mov dh,12
            call Gotoxy
            mov edx,OFFSET settings_cheats_text2
            call WriteString
    
            mov dl,9
            mov dh,14
            call Gotoxy
            mov edx,OFFSET settings_cheats_text3
            call WriteString
    
            mov dl,9
            mov dh,16
            call Gotoxy
            mov edx,OFFSET settings_cheats_text4
            call WriteString

                mov cheats_enabled_bool,1
                jmp chsetting_looper
                


            settings_up:
                call UpdateSelectionArrow_Settings
                dec settings_current_option
            
                cmp settings_current_option,0
                jne continue_drawing_settings_arrow1 

                mov settings_current_option,3

                continue_drawing_settings_arrow1:
                call DrawSelectionArrow_Settings
           
                jmp settings_looper

            settings_down:
                call UpdateSelectionArrow_Settings
                inc settings_current_option
                cmp settings_current_option,4
                jne continue_drawing_settings_arrow2

                mov settings_current_option,1

                continue_drawing_settings_arrow2:
                call DrawSelectionArrow_Settings
           
                jmp settings_looper

            settings_enter:
                cmp settings_current_option,1
                je back_selected_for_enter_Settings
                cmp settings_current_option,2
                je mute_selected_for_enter_Settings
                cmp settings_current_option,3
                je colour_selected_for_enter_Settings
                jmp settings_looper

                back_selected_for_enter_Settings:
                    ;back to menu
                    call DrawMenu
                    jmp menu_looper
                    

                mute_selected_for_enter_Settings:
                
                    mov eax, SND_FILENAME  
                    or eax, SND_LOOP       
                    or eax, SND_ASYNC 
                    invoke PlaySound, NULL,0,eax
                    jmp settings_looper

                colour_selected_for_enter_Settings:
                    
                        mov dl,50
                        mov dh,10
                        call gotoxy

                        call ReadInt
                        mov inputChar,al

                        cmp inputChar,1
                        jne nextcolor_1

                        mov pacmancolor,yellow
                        jmp settings_looper
                        
                        nextcolor_1:
                        cmp inputChar,2
                        jne settings_looper

                        mov pacmancolor,brown
                        jmp settings_looper

                    jmp settings_looper



                jmp settings_looper

        
        chsetting_looper:
            call DrawSelectionArrow_settings
            call ReadChar
            mov inputChar,al

            cmp inputChar,"w"
            je chsetting_up

            cmp inputChar,"s"
            je chsetting_down

            cmp inputChar,13
            je chsetting_enter 

            jmp chsetting_looper

            chsetting_up:
                call UpdateSelectionArrow_Settings
                dec settings_current_option
            
                cmp settings_current_option,0
                jne continue_drawing_chsetting_arrow1 

                mov settings_current_option,4

                continue_drawing_chsetting_arrow1:
                call DrawSelectionArrow_settings
           
                jmp chsetting_looper

            chsetting_down:
                call UpdateSelectionArrow_Settings
                inc settings_current_option
                cmp settings_current_option,5
                jne continue_drawing_chsetting_arrow2

                mov settings_current_option,1

                continue_drawing_chsetting_arrow2:
                call DrawSelectionArrow_settings
           
                jmp chsetting_looper

            chsetting_enter:
                cmp settings_current_option,1
                je back_selected_for_enter_chsetting
                cmp settings_current_option,2
                je mute_selected_for_enter_chsetting
                cmp settings_current_option,3
                je colour_selected_for_enter_chsetting
                cmp settings_current_option,4
                je cheats_selected_for_enter_chsetting
                jmp chsetting_looper

                back_selected_for_enter_chsetting:
                    ;back to menu
                    call DrawMenu
                    jmp menu_looper
                    

                mute_selected_for_enter_chsetting:
                
                    mov eax, SND_FILENAME  
                    or eax, SND_LOOP       
                    or eax, SND_ASYNC 
                    invoke PlaySound, NULL,0,eax
                    jmp chsetting_looper

                colour_selected_for_enter_chsetting:
                        
                        mov dl,75
                        mov dh,8
                        call gotoxy

                        call ReadInt
                        mov inputChar,al

                        cmp inputChar,1
                        jne nextcolor_2

                        mov pacmancolor,yellow
                        jmp chsetting_looper
                        
                        nextcolor_2:
                        cmp inputChar,2
                        jne chsetting_looper

                        mov pacmancolor,brown
                        jmp chsetting_looper



                    jmp chsetting_looper

                cheats_selected_for_enter_chsetting:
                        
                        mov dl,50
                        mov dh,10
                        call gotoxy

                        call ReadInt
                        mov inputChar,al

                        cmp inputChar,1
                        jne next_cheatcheck1

                        mov cheats_bool_powerup,1
                        jmp chsetting_looper
                        
                        next_cheatcheck1:
                        cmp inputChar,2
                        jne next_cheatcheck2

                        mov cheats_bool_levelskip,1
                        jmp chsetting_looper

                        next_cheatcheck2:
                        cmp inputChar,3
                        jne chsetting_looper
                        
                        mov cheats_bool_multiplier,10
                        jmp chsetting_looper


                    jmp chsetting_looper



                jmp chsetting_looper


MenuFunctionality_exit:
ret 
MenuFunctionality ENDP

DrawGameScreen PROC

    call clrscr 

; draw ground at (0,29):
    mov eax,yellow+(red*16) ;(black * 16)
    call SetTextColor
    mov dl,0
    mov dh,29
    call Gotoxy
    mov edx,OFFSET ground
    call WriteString
    mov dl,0
    mov dh,1
    call Gotoxy
    mov edx,OFFSET ground
    call WriteString
    
    ; drawing left wall
    mov ecx,27
    mov dh,2
    mov temp,dh
    l1:
     mov dh,temp
    mov dl,0
    call Gotoxy
    mov edx,OFFSET ground1
    call WriteString
    inc temp
    loop l1

    ; drawing right wall
    mov ecx,27
    mov dh,2
    mov temp,dh
    l2:
     mov dh,temp
    mov dl,119
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    loop l2

    mov ecx,27
    mov dh,2
    mov temp,dh
    l3:
    mov dh,temp
    mov dl,120
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    loop l3

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    l4:
    mov dh,temp
    mov dl,158
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    loop l4

    ; draw vertical right menu border
    mov ecx,27
    mov dh,2
    mov temp,dh
    l5:
    mov dh,temp
    mov dl,159
    call Gotoxy
    mov edx,OFFSET ground2
    call WriteString
    inc temp
    loop l5

    mov eax,magenta+(yellow*16)
    call settextcolor

    mov ecx,27
    mov dh,2
    mov temp,dh
    loop5:
    mov dh,temp
    mov dl,121
    call Gotoxy
    mov edx,OFFSET sidebar_empty
    call WriteString
    inc temp
    loop loop5

    mov dl,130
    mov dh,10
    call gotoxy
    mov edx,offset hscr_str
    call writestring
    
    mov ecx,10
    mov dh,12
    mov temp,dh
    mov esi,offset filehandling_array
    loop6:
    push ecx
    call stats_array_maker
    pop ecx
    mov dh,temp
    mov dl,130
    call Gotoxy
    mov edx,OFFSET top5_stats_str
    call WriteString
    inc temp
    add esi,15
    loop loop6
    
    mov eax,blue
    call SetTextColor
    call DrawLevelWalls
    call CountCoinsInLevel

    call DrawPlayer
    call ColorSlashes

    mov current_ghost,1
    call DrawGhost
    cmp current_level,3
    jne DrawGameScreen_exit
    mov current_ghost,2
    call DrawGhost
    mov current_ghost,3
    call DrawGhost

    

DrawGameScreen_exit:
    mov eax,magenta
    call settextcolor
ret
DrawGameScreen ENDP

stats_array_maker PROC

        mov al, [esi]
        mov top5_stats_str[0], al
        mov al, [esi + 1]
        mov top5_stats_str[1], al
        mov al, [esi + 2]
        mov top5_stats_str[2], al
        mov al, [esi + 3]
        mov top5_stats_str[3], al
        mov al, [esi + 4]
        mov top5_stats_str[4], al
        mov al, [esi + 5]
        mov top5_stats_str[5], al
        mov al, [esi + 6]
        mov top5_stats_str[6], al
        mov al, [esi + 7]
        mov top5_stats_str[7], al
        mov al, [esi + 8]
        mov top5_stats_str[8], al
        mov al, [esi + 9]
        mov top5_stats_str[9], al
        mov al, ' '
        mov top5_stats_str[10], al
        mov al, [esi + 10]
        mov top5_stats_str[11], al
        mov al, [esi + 11]
        mov top5_stats_str[12], al
        mov al, [esi + 12]
        mov top5_stats_str[13], al
        mov al, [esi + 13]
        mov top5_stats_str[14], al
        mov al, ' '
        mov top5_stats_str[15], al
        mov al, [esi+14]
        mov top5_stats_str[16], al

        mov ecx,15
        mov ebp,0
    spacer_loop:
        cmp top5_stats_str[ebp],0
        jne spacer_loop_cont

        mov top5_stats_str[ebp],' '

        spacer_loop_cont:
        inc ebp
        LOOP spacer_loop

        mov top5_stats_str[17],0

ret
stats_array_maker ENDP

PrintScore PROC

    mov dl,122
    mov dh,7
    call gotoxy

    mov eax,magenta+(yellow*16)
    call settextcolor

    
    mov edx,OFFSET strScore1
    call WriteString

    mov eax,score
    call WriteInt

    
    mov eax,magenta
    call settextcolor
ret
PrintScore ENDP

PrintLives PROC

    mov dl,122
    mov dh,5
    call gotoxy

    mov eax,magenta+(yellow*16)
    call settextcolor

    
    mov edx,OFFSET strLives
    call WriteString

    mov eax,current_lives
    call WriteInt

    
    mov eax,magenta
    call settextcolor
ret
PrintLives ENDP

PrintName PROC

    mov dl,122
    mov dh,3
    call gotoxy

    mov eax,magenta+(yellow*16)
    call settextcolor
    
    mov edx,OFFSET strName
    call WriteString
    
    mov edx,OFFSET player_name
    call WriteString

ret
PrintName ENDP

ResetVariables PROC

    mov xPos, 5
    mov yPos, 3

    mov current_lives, 3
    
    mov direction_ghost_1, 3
    mov direction_ghost_2, 2
    mov direction_ghost_3, 4
    mov current_ghost, 1
    mov has_ghost1_changed_direction, 1
    mov has_ghost2_changed_direction, 1
    mov has_ghost3_changed_direction, 1
    mov random90degreechange, 0

    mov xPosGhost1, 59
    mov yPosGhost1, 15
    mov xPosGhost2, 56
    mov yPosGhost2, 15
    mov xPosGhost3, 62
    mov yPosGhost3, 15

    mov total_coin_count, 0

ret
ResetVariables ENDP

MakeHighScoreFile PROC

    mov ebx,GENERIC_READ
    OR ebx,GENERIC_WRITE
    invoke CreateFile ,offset highscores_file_name,ebx,0,NULL,OPEN_ALWAYS,FILE_ATTRIBUTE_NORMAL,highscores_file_handle
    mov highscores_file_handle,eax
    mov eax,highscores_file_handle
    call closefile

    mov edx,OFFSET highscores_file_name
    call OpenInputFile
    mov highscores_file_handle,eax

    call WriteWindowsMsg
ret
MakeHighScoreFile ENDP

ReadHighScoreFile PROC

    mov  eax,highscores_file_handle
    mov  edx,offset filehandling_array
    mov  ecx,lengthof filehandling_array
    call readfromfile

    mov eax,highscores_file_handle
    call closefile

ret
ReadHighScoreFile ENDP

WriteHighScoreFile PROC

      mov  edx,OFFSET highscores_file_name
      call CreateOutputFile
      mov  highscores_file_handle,eax

    mov esi,offset filehandling_array
    mov ecx,10
    mov temp_index,0
    placer_loop:
        mov dl,'-'
        cmp [esi],dl
        je place_here

        mov temp_filehandling_score,0
        movzx eax,byte ptr[esi+10]
        sub eax,48
        imul eax,1000
        add temp_filehandling_score,eax
        movzx eax,byte ptr[esi+11]
        sub eax,48
        imul eax,100
        add temp_filehandling_score,eax
        movzx eax,byte ptr[esi+12]
        sub eax,48
        imul eax,10
        add temp_filehandling_score,eax
        movzx eax,byte ptr[esi+13]
        sub eax,48
        add temp_filehandling_score,eax

        mov eax,score
        cmp temp_filehandling_score,eax
        jbe place_here

        add esi,15
        inc temp_index
    LOOP placer_loop

    
    mov eax,highscores_file_handle
    call closefile
    ret


    place_here:
        mov al,[esi]
        mov temp_filehandling_array2[0],al
        mov al,[esi+1]
        mov temp_filehandling_array2[1],al
        mov al,[esi+2]
        mov temp_filehandling_array2[2],al
        mov al,[esi+3]
        mov temp_filehandling_array2[3],al
        mov al,[esi+4]
        mov temp_filehandling_array2[4],al
        mov al,[esi+5]
        mov temp_filehandling_array2[5],al
        mov al,[esi+6]
        mov temp_filehandling_array2[6],al
        mov al,[esi+7]
        mov temp_filehandling_array2[7],al
        mov al,[esi+8]
        mov temp_filehandling_array2[8],al
        mov al,[esi+9]
        mov temp_filehandling_array2[9],al
        mov al,[esi+10]
        mov temp_filehandling_array2[10],al
        mov al,[esi+11]
        mov temp_filehandling_array2[11],al
        mov al,[esi+12]
        mov temp_filehandling_array2[12],al
        mov al,[esi+13]
        mov temp_filehandling_array2[13],al
        mov al,[esi+14]
        mov temp_filehandling_array2[14],al


        mov al,player_name[0]
        mov byte ptr [esi],al
        mov al,player_name[1]
        mov byte ptr [esi+1],al
        mov al,player_name[2]
        mov byte ptr [esi+2],al
        mov al,player_name[3]
        mov byte ptr [esi+3],al
        mov al,player_name[4]
        mov byte ptr [esi+4],al
        mov al,player_name[5]
        mov byte ptr [esi+5],al
        mov al,player_name[6]
        mov byte ptr [esi+6],al
        mov al,player_name[7]
        mov byte ptr [esi+7],al
        mov al,player_name[8]
        mov byte ptr [esi+8],al
        mov al,player_name[9]
        mov byte ptr [esi+9],al
        mov eax,score
        mov cl,'0'
        mov edx,0
        mov ebx,0
        mov bl,10
        div ebx
        add cl,dl
        mov byte ptr [esi+13],cl
        mov cl,'0'
        mov edx,0
        mov ebx,0
        mov bl,10
        div ebx
        add cl,dl
        mov byte ptr [esi+12],cl
        mov cl,'0'
        mov edx,0
        mov ebx,0
        mov bl,10
        div ebx
        add cl,dl
        mov byte ptr [esi+11],cl
        mov cl,'0'
        add cl,al
        mov byte ptr [esi+10],cl
        mov cl,'0'
        add cl,current_level
        mov byte ptr [esi+14],cl

        add esi,15

        mov ecx,10
        sub ecx,temp_index
        dec ecx
        swapper_loop:
            mov al,[esi]
            mov temp_filehandling_array[0],al
            mov al,[esi+1]
            mov temp_filehandling_array[1],al
            mov al,[esi+2]
            mov temp_filehandling_array[2],al
            mov al,[esi+3]
            mov temp_filehandling_array[3],al
            mov al,[esi+4]
            mov temp_filehandling_array[4],al
            mov al,[esi+5]
            mov temp_filehandling_array[5],al
            mov al,[esi+6]
            mov temp_filehandling_array[6],al
            mov al,[esi+7]
            mov temp_filehandling_array[7],al
            mov al,[esi+8]
            mov temp_filehandling_array[8],al
            mov al,[esi+9]
            mov temp_filehandling_array[9],al
            mov al,[esi+10]
            mov temp_filehandling_array[10],al
            mov al,[esi+11]
            mov temp_filehandling_array[11],al
            mov al,[esi+12]
            mov temp_filehandling_array[12],al
            mov al,[esi+13]
            mov temp_filehandling_array[13],al
            mov al,[esi+14]
            mov temp_filehandling_array[14],al
            
            mov al, temp_filehandling_array2[0]
            mov [esi], al
            mov al, temp_filehandling_array2[1]
            mov [esi + 1], al
            mov al, temp_filehandling_array2[2]
            mov [esi + 2], al
            mov al, temp_filehandling_array2[3]
            mov [esi + 3], al
            mov al, temp_filehandling_array2[4]
            mov [esi + 4], al
            mov al, temp_filehandling_array2[5]
            mov [esi + 5], al
            mov al, temp_filehandling_array2[6]
            mov [esi + 6], al
            mov al, temp_filehandling_array2[7]
            mov [esi + 7], al
            mov al, temp_filehandling_array2[8]
            mov [esi + 8], al
            mov al, temp_filehandling_array2[9]
            mov [esi + 9], al
            mov al, temp_filehandling_array2[10]
            mov [esi + 10], al
            mov al, temp_filehandling_array2[11]
            mov [esi + 11], al
            mov al, temp_filehandling_array2[12]
            mov [esi + 12], al
            mov al, temp_filehandling_array2[13]
            mov [esi + 13], al
            mov al, temp_filehandling_array2[14]
            mov [esi + 14], al

            mov al, temp_filehandling_array[0]
            mov temp_filehandling_array2[0], al

            mov al, temp_filehandling_array[1]
            mov temp_filehandling_array2[1], al

            mov al, temp_filehandling_array[2]
            mov temp_filehandling_array2[2], al

            mov al, temp_filehandling_array[3]
            mov temp_filehandling_array2[3], al

            mov al, temp_filehandling_array[4]
            mov temp_filehandling_array2[4], al

            mov al, temp_filehandling_array[5]
            mov temp_filehandling_array2[5], al

            mov al, temp_filehandling_array[6]
            mov temp_filehandling_array2[6], al

            mov al, temp_filehandling_array[7]
            mov temp_filehandling_array2[7], al

            mov al, temp_filehandling_array[8]
            mov temp_filehandling_array2[8], al

            mov al, temp_filehandling_array[9]
            mov temp_filehandling_array2[9], al

            mov al, temp_filehandling_array[10]
            mov temp_filehandling_array2[10], al

            mov al, temp_filehandling_array[11]
            mov temp_filehandling_array2[11], al

            mov al, temp_filehandling_array[12]
            mov temp_filehandling_array2[12], al

            mov al, temp_filehandling_array[13]
            mov temp_filehandling_array2[13], al

            mov al, temp_filehandling_array[14]
            mov temp_filehandling_array2[14], al

            add esi,15
        dec ecx
        cmp ecx,0
        jne swapper_loop
        

    mov  eax,highscores_file_handle
    mov  edx,offset filehandling_array
    mov  ecx,lengthof filehandling_array
    call writetoFile

    mov eax,highscores_file_handle
    call closefile

ret
WriteHighScoreFile ENDP

END main